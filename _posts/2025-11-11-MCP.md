---
layout: post
title: "Bricolages MCP"
date: 2025-11-11
---



# Guide Complet sur le Model Context Protocol (MCP)

## R√©sum√©

Ce document pr√©sente le **Model Context Protocol (MCP)**, un framework open-source initi√© par [Anthropic](https://www.anthropic.com/). Il d√©taille son objectif de standardisation des int√©grations entre les syst√®mes d'IA (comme les LLM) et les outils externes.

Cette documentation couvre :
- La d√©finition et l'objectif du MCP.
- Une liste des serveurs MCP publiquement disponibles.
- Un guide complet pour connecter Claude Desktop √† n8n, d√©taillant trois approches d'int√©gration.
- Une documentation sp√©cifique pour l'installation et l'utilisation du serveur MCP Puppeteer pour l'automatisation de navigateur.

---

## Qu'est-ce que le Model Context Protocol (MCP) ?

Le Model Context Protocol (MCP) est un framework open-source con√ßu pour standardiser la mani√®re dont les grands mod√®les de langage (LLM) s'int√®grent et partagent des donn√©es avec des outils et des sources de donn√©es externes.

Il fournit une interface universelle permettant des connexions s√©curis√©es et bidirectionnelles. L'objectif principal est de simplifier des int√©grations qui n√©cessitaient auparavant des d√©veloppements personnalis√©s et complexes pour chaque outil.

- **Documentation Officielle** : [modelcontextprotocol.io](https://modelcontextprotocol.io/)

---

## Serveurs MCP Principaux

Voici une liste des serveurs MCP (Model Context Protocol) couramment utilis√©s et disponibles publiquement :

- **Filesystem** : Permet l'acc√®s s√©curis√© aux fichiers et dossiers locaux.
- **GitHub** : Int√©gration avec les repositories (recherche, gestion de fichiers, issues, pull requests).
- **PostgreSQL** : Connexion et ex√©cution de requ√™tes sur des bases de donn√©es PostgreSQL.
- **Slack** : Int√©gration pour la gestion des canaux et des messages.
- **Google Drive** : Acc√®s aux fichiers et dossiers Google Drive.
- **Puppeteer** : Automatisation de navigateur web et web scraping (d√©taill√© plus bas).
- **Memory** : Syst√®me de m√©moire persistante pour stocker des informations entre les sessions.
- **Brave Search** : Int√©gration avec le moteur de recherche Brave.

---

## Connexion Claude & n8n via MCP

Ce guide explique comment connecter Claude Desktop √† votre instance n8n pour d√©ployer automatiquement des workflows via des prompts.

### üéØ Approche 1 : Serveur `n8n-mcp` (Recommand√© pour la cr√©ation de workflows)

Ce serveur MCP donne √† Claude une connaissance compl√®te de tous les n≈ìuds n8n (525+), lui permettant de construire des workflows JSON valides du premier coup.

#### Installation via Docker (M√©thode recommand√©e)

Ajoutez cette configuration dans votre fichier `claude_desktop_config.json` :

- **MacOS/Linux** : `~/Library/Application Support/Claude/claude_desktop_config.json`
- **Windows** : `%APPDATA%\Claude\claude_desktop_config.json`

```json
{
  "mcpServers": {
    "n8n-mcp": {
      "command": "docker",
      "args": ["run", "-i", "--rm", "--init", "ghcr.io/czlonkowski/n8n-mcp:latest"]
    }
  }
}
```

#### ‚ú® Fonctionnalit√©s

- Acc√®s √† plus de 525 n≈ìuds n8n (99% de couverture des propri√©t√©s).
- Inclusion de 2 646 exemples de configurations r√©elles.
- Validation de la configuration avant le d√©ploiement.
- Temps de r√©ponse moyen de 12ms (base SQLite).
- Recherche intelligente de n≈ìuds (par nom, cat√©gorie, fonctionnalit√©).

#### üìù Exemple d'utilisation

Apr√®s installation et red√©marrage de Claude Desktop, vous pouvez demander :
> "Cr√©e-moi un workflow n8n qui envoie un email quotidien avec les nouveaux articles d'un flux RSS."

Claude g√©n√©rera un workflow JSON complet, pr√™t √† √™tre import√© dans n8n.

### üîß Approche 2 : MCP Server `n8n-mcp-server` (Pour le contr√¥le de votre instance)

Ce serveur vous permet de g√©rer directement votre instance n8n auto-h√©berg√©e depuis Claude (lister, cr√©er, ex√©cuter des workflows).

#### üîë Pr√©requis

- Une instance n8n auto-h√©berg√©e (version 1.0+).
- Une cl√© API n8n.
- Node.js 18 ou sup√©rieur.

#### üì¶ Installation via NPX

Ajoutez ceci √† votre fichier `claude_desktop_config.json` :

```json
{
  "mcpServers": {
    "n8n": {
      "command": "npx",
      "args": ["-y", "@ahmad.soliman/mcp-n8n-server"],
      "env": {
        "N8N_HOST_URL": "https://votre-instance-n8n.com",
        "PROJECT_ID": "votre_project_id",
        "N8N_API_KEY": "votre_cle_api"
      }
    }
  }
}
```
*Note : `PROJECT_ID` est optionnel, requis uniquement pour les instances cloud n8n.*

#### ‚ú® Fonctionnalit√©s disponibles

- Lister tous les workflows n8n.
- Ex√©cuter des workflows manuellement (avec donn√©es personnalis√©es).
- Activer et d√©sactiver des workflows.
- Voir l'historique et les d√©tails des ex√©cutions.
- Lister et appeler les webhooks.
- Cr√©er, mettre √† jour et supprimer des workflows (CRUD).

### üî® Approche 3 : `MCP Server Trigger` (Natif n8n)

Depuis n8n v1.88, vous pouvez utiliser le n≈ìud natif `MCP Server Trigger` pour exposer vos workflows directement √† Claude.

#### Configuration dans n8n

1. Cr√©ez un nouveau workflow dans n8n.
2. Ajoutez le n≈ìud **`MCP Server Trigger`**.
3. Connectez-y des n≈ìuds **`Custom n8n Workflow Tool`** pour exposer des workflows sp√©cifiques.
4. Activez le workflow pour obtenir l'URL de production.
5. Configurez l'authentification (optionnel mais recommand√©).

#### Configuration dans Claude Desktop

Claude Desktop ne supportant pas directement les connexions SSE (Server-Sent Events), vous devez utiliser un **gateway SSE**.

```json
{
  "mcpServers": {
    "n8n-workflow": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-sse",
        "--sse-url",
        "URL_MCP_N8N",
        "--header",
        "Authorization: Bearer VOTRE_TOKEN"
      ]
    }
  }
}
```
Remplacez `URL_MCP_N8N` par l'URL de production du n≈ìud MCP Server Trigger et `VOTRE_TOKEN` par votre token d'authentification.

> **‚ö†Ô∏è Important pour les Reverse Proxy**
> Si vous utilisez nginx ou Caddy, vous devez configurer SSE correctement. Pour nginx, ajoutez ces directives pour le endpoint `/mcp*` :
> `proxy_buffering off; proxy_cache off; proxy_set_header Connection ''; chunked_transfer_encoding off;`

### üîÑ Quelle approche choisir ?

- **Approche 1 (`n8n-mcp`)** : Id√©al pour **CONSTRUIRE** des workflows. Claude conna√Æt tous les n≈ìuds et peut g√©n√©rer des workflows JSON parfaits. Installation simple (Docker).
- **Approche 2 (`n8n-mcp-server`)** : Id√©al pour **G√âRER** votre instance n8n existante. Permet de lister, ex√©cuter, et administrer vos workflows via Claude.
- **Approche 3 (`MCP Server Trigger`)** : Int√©gration native mais plus complexe √† configurer (n√©cessite un gateway SSE et une configuration proxy).

#### üöÄ Recommandation (Configuration Combin√©e)

Pour d√©ployer automatiquement des flux depuis un prompt, la meilleure solution est de combiner les approches 1 et 2.

1. Utilisez **`n8n-mcp`** (Approche 1) pour que Claude vous aide √† **concevoir** le workflow.
2. Utilisez **`n8n-mcp-server`** (Approche 2) pour **d√©ployer** automatiquement le workflow JSON g√©n√©r√© dans votre instance n8n.

##### Configuration combin√©e

Ajoutez les **DEUX** serveurs dans votre `claude_desktop_config.json` :

```json
{
  "mcpServers": {
    "n8n-mcp": {
      "command": "docker",
      "args": ["run", "-i", "--rm", "--init", "ghcr.io/czlonkowski/n8n-mcp:latest"]
    },
    "n8n-instance": {
      "command": "npx",
      "args": ["-y", "@ahmad.soliman/mcp-n8n-server"],
      "env": {
        "N8N_HOST_URL": "https://votre-n8n.com",
        "N8N_API_KEY": "votre_cle_api"
      }
    }
  }
}
```

##### Workflow type d'utilisation

1. Dites √† Claude : *"Cr√©e un workflow n8n qui fait [X]."* (Claude utilisera `n8n-mcp` pour g√©n√©rer le JSON).
2. Ensuite, dites : *"D√©ploie ce workflow sur mon instance n8n."* (Claude utilisera `n8n-mcp-server` pour cr√©er le workflow dans votre instance).

### üîë O√π trouver votre cl√© API n8n

1. Ouvrez votre instance n8n.
2. Allez dans **Settings** (Param√®tres).
3. Cliquez sur **API**.
4. Cliquez sur **Create API Key**.
5. Copiez la cl√© (elle ne sera plus visible apr√®s la fermeture).

---

## Documentation : Serveur MCP Puppeteer

Le serveur MCP Puppeteer offre des capacit√©s d'automatisation de navigateur, permettant aux LLM d'interagir avec des pages web, prendre des captures d'√©cran, et ex√©cuter du JavaScript dans un environnement de navigateur r√©el.

### üì¶ Installation et Configuration

Il existe deux m√©thodes principales d'installation :

1.  **Via NPX (Ouvre une fen√™tre de navigateur visible)**
    -   Commande: `npx -y @modelcontextprotocol/server-puppeteer`
    -   Configuration Claude Desktop:
        ```json
        {
          "mcpServers": {
            "puppeteer": {
              "command": "npx",
              "args": ["-y", "@modelcontextprotocol/server-puppeteer"]
            }
          }
        }
        ```

2.  **Via Docker (Mode "headless" - sans interface graphique)**
    -   Commande: `docker run -i --rm --init -e DOCKER_CONTAINER=true mcp/puppeteer`
    -   Configuration Claude Desktop:
        ```json
        {
          "mcpServers": {
            "puppeteer": {
              "command": "docker",
              "args": [
                "run",
                "-i",
                "--rm",
                "--init",
                "-e",
                "DOCKER_CONTAINER=true",
                "mcp/puppeteer"
              ]
            }
          }
        }
        ```

### üîß Outils et Cas d'usage

#### Outils disponibles

- `puppeteer_navigate`: Naviguer vers une URL sp√©cifique.
- `puppeteer_screenshot`: Capturer des captures d'√©cran (page enti√®re ou √©l√©ments).
- `puppeteer_click`: Cliquer sur des √©l√©ments de la page.
- `puppeteer_hover`: Survoler des √©l√©ments avec la souris.
- `puppeteer_fill`: Remplir des formulaires et champs de saisie.
- `puppeteer_select`: S√©lectionner des options dans des menus d√©roulants.
- `puppeteer_evaluate`: Ex√©cuter du code JavaScript personnalis√©.

#### Cas d'usage principaux

- Web scraping et extraction de donn√©es dynamiques (JS-heavy).
- Tests automatiques d'applications web.
- Capture de screenshots pour documentation ou surveillance.
- Automatisation de workflows multi-√©tapes (connexion, extraction, etc.).

### üîë Options de lancement personnalis√©es

Vous pouvez personnaliser le comportement du navigateur de deux mani√®res :

1.  **Via variable d'environnement `PUPPETEER_LAUNCH_OPTIONS`** :
    ```json
    {
      "mcpServers": {
        "puppeteer": {
          "command": "npx",
          "args": ["-y", "@modelcontextprotocol/server-puppeteer"],
          "env": {
            "PUPPETEER_LAUNCH_OPTIONS": "{ \"headless\": false, \"executablePath\": \"C:/Program Files/Google/Chrome/Application/chrome.exe\" }",
            "ALLOW_DANGEROUS": "true"
          }
        }
      }
    }
    ```
2.  **Via param√®tres lors de l'appel des outils** :
    `{ "url": "https://example.com", "launchOptions": { "headless": false } }`

---

## Installation de Gemini CLI

- **Pr√©requis** : Assurez-vous que Node.js (version 18+) et npm sont install√©s.
- **Installez Gemini CLI globalement** avec la commande : `npm install -g @google/gemini-cli`
- **V√©rifiez l'installation** avec : `gemini --version`
- **Configurez votre compte** en ex√©cutant `gemini` et en suivant les instructions.

---

## üí° S√©curit√© et D√©pannage

- **S√©curit√©** : V√©rifiez le format JSON, s√©curisez vos fichiers de configuration, et limitez l'acc√®s au serveur. N'utilisez `ALLOW_DANGEROUS: true` que si c'est absolument n√©cessaire.
- **D√©pannage** : En cas d'erreur, v√©rifiez les logs de la console, assurez-vous que le serveur MCP est bien en cours d'ex√©cution, et v√©rifiez le `executablePath` si vous utilisez un navigateur sp√©cifique.

---

## üìö R√©f√©rences

- **n8n-mcp (Cr√©ation)** : [https://github.com/czlonkowski/n8n-mcp](https://github.com/czlonkowski/n8n-mcp)
- **n8n-mcp-server (Contr√¥le)** : [https://github.com/ahmadsoliman/mcp-n8n-server](https://github.com/ahmadsoliman/mcp-n8n-server)
- **n8n MCP Server Trigger (Natif)** : [https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-langchain.mcptrigger/](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-langchain.mcptrigger/)
- **Puppeteer MCP (NPM)** : [https://www.npmjs.com/package/@modelcontextprotocol/server-puppeteer](https://www.npmjs.com/package/@modelcontextprotocol/server-puppeteer)
- **Documentation MCP Officielle** : [https://modelcontextprotocol.io/](https://modelcontextprotocol.io/)
